<!-- training.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>ネットワーク学習ツール</title>

    <!-- 既存CSS -->
    <link rel="stylesheet" href="../CSS/style.css" />
    <link rel="stylesheet" href="../CSS/map.css" />

    <!-- Leaflet -->
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
</head>
<body>
    <header>
        <h1>ネットワーク学習ツール</h1>
        <nav>
            <ul>
                <li><a href="../index.html">ホーム</a></li>
                <li><a href="#">トレーニング</a></li>
                <li><a href="#">このサイトについて</a></li>
            </ul>
        </nav>
    </header>

    <main class="page-wrap">
        <section class="main-section">
            <h2>日本地図（インタラクティブ） ＋ 操作画面プレビュー</h2>

            <div class="grid">
                <!-- 左：日本地図（正方形）＋ 設計ビュー -->
                <div class="card-stack">
                    <div class="card map-card">
                        <div class="card-head head-inline">
                            <span>日本地図（クリックで機器設定を表示）</span>
                            <span class="badge badge-ng" id="focusBadge">F</span>
                        </div>
                        <div class="card-body">
                            <div id="map" role="img" aria-label="日本地図（インタラクティブ）"></div>
                            <p class="note">東京＝自宅Wi-Fi、福岡＝会社ネットワーク。クリックで機器ディテールが表示され、ダブルクリックで各シミュレータを新規タブで開きます。</p>
                            <div class="diag-line">
                                状態: <span id="diag">—</span>
                            </div>
                        </div>
                    </div>

                    <div class="card focus-card">
                        <div class="card-head head-inline">
                            <span>全体像と設計ビュー</span>
                            <span class="badge badge-ng" id="detailBadge">F</span>
                        </div>
                        <div class="card-body focus-body">
                            <p class="note">対象: 企業ネットワーク/セキュリティ研修。配線を変えると結果が変わる「ネットワーク実験」として示し、静的な図との差分を明確にします。</p>

                            <div class="segment-row">
                                <div class="segment-block" data-segment="outside">
                                    <div class="segment-label">外側 (ISP)</div>
                                    <div class="segment-status" id="segmentOutside">未接続</div>
                                </div>
                                <div class="segment-block" data-segment="firewall">
                                    <div class="segment-label">境界/FW</div>
                                    <div class="segment-status" id="segmentFirewall">未設置</div>
                                </div>
                                <div class="segment-block" data-segment="inside">
                                    <div class="segment-label">内側 (LAN)</div>
                                    <div class="segment-status" id="segmentInside">未構築</div>
                                </div>
                            </div>

                            <div class="detail-panel">
                                <div class="detail-head">
                                    <div>
                                        <div class="eyebrow">選択中の機器</div>
                                        <h3 id="detailTitle">Home PC</h3>
                                        <p id="detailSummary">マップ上のマーカーをクリックすると設定と妥当性が表示されます。</p>
                                    </div>
                                </div>
                                <ul id="detailList" class="detail-list">
                                    <li>配線状況を読み込み中...</li>
                                </ul>
                                <div class="detail-actions">
                                    <button id="detailOpenBtn" class="btn ghost" type="button">関連画面を開く</button>
                                    <button id="detailRefresh" class="btn" type="button">状態を再読込</button>
                                </div>
                            </div>

                            <div class="install-block">
                                <div class="eyebrow">空のPCに入れるソフトウェア</div>
                                <p class="note">PCを物理専用機と誤認させないよう、必要ソフトをダウンロード→導入する流れを明示します。</p>
                                <div id="installList" class="install-list" aria-live="polite"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右：操作画面プレビュー＋診断 -->
                
                <aside class="preview-col">
                    <div class="card pc-card">
                        <div class="card-head head-inline">
                            <span>ユーザーPC（Windows風ブラウザ）</span>
                            <span id="pcConnBadge" class="badge badge-ng" aria-live="polite">F</span>
                        </div>
                        <div class="card-body">
                            <div class="pc-window" aria-live="polite">
                                <div class="pc-window__bar">
                                    <span class="pc-led red"></span>
                                    <span class="pc-led yellow"></span>
                                    <span class="pc-led green"></span>
                                    <span class="pc-title">Virtual Windows</span>
                                </div>
                                <div class="pc-address">
                                    <span>URL:</span>
                                    <span id="pcAddress">https://www.google.com/</span>
                                </div>
                                <div class="pc-screen" id="pcScreen">
                                    <div class="pc-screen__error">
                                        <strong>接続エラー</strong>
                                        <p>3/3 の配線がそろうと Google へ接続できます。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="pc-links">
                                <a class="btn ghost" href="./home.html" target="_blank" rel="noreferrer">自宅シミュレータを開く</a>
                            </div>
                        </div>
                    </div>

                    <div class="card company-card">
                        <div class="card-head head-inline">
                            <span>会社（HTMLアップ / FTP接続）</span>
                            <span id="companyConnBadge" class="badge badge-ng" aria-live="polite">F</span>
                        </div>
                        <div class="card-body company-body">
                            <div class="preview-lock" id="companyLock">
                                <p>会社ネットワークで ONU→ルーター→Webサーバー が接続されると、ここに社内画面を読み込みます。</p>
                            </div>
                            <iframe class="preview-iframe" id="companyPreview" title="company preview" loading="lazy" hidden></iframe>
                            
                            <div class="ftp-state">
                                <span>FTP接続判定:</span>
                                <span id="ftpStatus" class="badge badge-ng">F</span>
                            </div>
                            <div id="ftpConsole" class="ftp-console" hidden>
                                <div class="ftp-console__header">
                                    <p class="note">会社側が T になると解禁。用意済み or 自作の HTML を 3 拠点に割り当ててプレビューできます。</p>
                                    <label class="btn ghost">
                                        ローカルから追加
                                        <input id="ftpInlineFile" type="file" accept=".html,.htm,.txt" hidden />
                                    </label>
                                </div>
                                <div id="ftpSlots" class="ftp-console__slots"></div>
                                <div class="ftp-console__controls">
                                    <label>
                                        <span>割り当てファイル</span><br />
                                        <select id="ftpUploadSelect"></select>
                                    </label>
                                    <button id="ftpAssignBtn" type="button" class="btn primary">割り当てる</button>
                                </div>
                                <div class="ftp-preview">
                                    <div class="ftp-preview__head">
                                        <strong id="ftpPreviewLabel">プレビュー</strong>
                                    </div>
                                    <iframe id="ftpPreview" title="FTP preview"></iframe>
                                </div>
                            </div>
                            <div class="pc-links">
                                <a class="btn ghost" href="./company.html" target="_blank" rel="noreferrer">会社シミュレータを開く</a>
                            </div>

                        </div>
                    </div>
<!-- 保存・診断 -->
                    <div class="card">
                        <div class="card-head">保存状態（メモリ診断）</div>
                        <div class="card-body" style="display:grid; gap:8px;">
                            <div class="row" style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button id="btn-reload" class="btn">保存状態を再読込</button>
                                <button id="btn-save-home-ok" class="btn">Home 到達を保存（テスト）</button>
                                <button id="btn-save-company-ok" class="btn">Company 到達を保存（テスト）</button>
                                <button id="btn-clear" class="btn">全消去（localStorage）</button>
                            </div>
                            <p class="note">全ページ共通で localStorage を使用します（同一オリジン）。</p>
                        </div>
                    </div>
                </aside>
            </div>

            <noscript>
                <p>JavaScript が無効のため静的地図を表示します。</p>
                <img src="../assets/japan-map.png" alt="日本地図（静的画像）" width="600" height="600" />
            </noscript>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 ネットワーク学習プロジェクト. All Rights Reserved.</p>
    </footer>

    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>



    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- すべてのHTML共通の前段に置く -->
    <script src="../JS/store.js"></script>
    <script>
        AppStore.configure({
            key: 'app:network:saves:default',
            version: 1,
            scope: 'local',        // 単一タブ内で共有/local：タブ間共有・永続
            importOnStart: true      // 初回に local → session を自動取り込み
        });
    </script>

    <!-- training 起動 -->
    <script src="../JS/training_boot.js" defer></script>
    <script src="../JS/training.js"></script>
</body>
</html>
